<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <script type="module">
        // Firebase 配置
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.3.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.3.0/firebase-auth.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.3.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyB-sxwqPjcQp2kR3fubkhw7xg8m2FztgcA",
            authDomain: "wallet-demo-74c8b.firebaseapp.com",
            projectId: "wallet-demo-74c8b",
            storageBucket: "wallet-demo-74c8b.firebasestorage.app",
            messagingSenderId: "727957421920",
            appId: "1:727957421920:web:b5bff9853e2e8510db2805"
        };

        // 初始化 Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth();
        const db = getFirestore();

        // 监听用户是否登录
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                document.getElementById("user-email").innerText = user.email;

                // 获取 Firestore 里的用户信息
                const userDoc = await getDoc(doc(db, "users", user.uid));
                if (userDoc.exists()) {
                    document.getElementById("user-name").innerText = userDoc.data().name;
                    document.getElementById("user-funds").innerText = `余额: $${userDoc.data().Funds}`;
                } else {
                    document.getElementById("user-funds").innerText = "用户信息未找到";
                }
            } else {
                window.location.href = "index.html"; // 未登录就跳回登录页面
            }
        });

        // 登出功能
        document.getElementById("logout-btn").addEventListener("click", () => {
            signOut(auth).then(() => {
                window.location.href = "index.html";
            });
        });

        // 跳转到转账页面
        document.getElementById("transfer-btn").addEventListener("click", () => {
            window.location.href = "transfer.html";
        });

    </script>
</head>
<body>
    <h1>欢迎来到电子钱包 Dashboard</h1>
    <p><strong>邮箱:</strong> <span id="user-email"></span></p>
    <p><strong>姓名:</strong> <span id="user-name"></span></p>
    <p><strong>余额:</strong> <span id="user-funds"></span></p>

    <button id="transfer-btn">转账</button>
    <button id="logout-btn">登出</button>
</body>
</html>
